<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipo - TaskFlow Solutions</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="logo" style="margin-bottom: 40px; text-align: left;">
                <h2 style="font-size: 1.5rem;">TaskFlow <span style="color: var(--primary-color);">.</span></h2>
            </div>

            <nav>
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="kanban.html" class="nav-item">
                    <i class="fas fa-columns"></i> Mis Tareas
                </a>
                <a href="fichajes.html" class="nav-item">
                    <i class="fas fa-clock"></i> Fichajes
                </a>
                <a href="proyectos.html" class="nav-item">
                    <i class="fas fa-project-diagram"></i> Proyectos
                </a>
                <a href="equipo.html" class="nav-item active">
                    <i class="fas fa-users"></i> Equipo
                </a>
            </nav>

            <div style="margin-top: auto;">
                <div class="user-profile" style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <div
                        style="width: 40px; height: 40px; background: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <p id="userName" style="font-weight: 600; font-size: 0.9rem;">Cargando...</p>
                        <p id="userRole" style="font-size: 0.8rem; color: #666;">...</p>
                    </div>
                </div>
                <button onclick="logout()" class="btn btn-secondary" style="width: 100%; font-size: 0.9rem;">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                </button>
            </div>
        </aside>

        <main class="main-content">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <div>
                    <h1>Equipo de Trabajo</h1>
                    <p style="color: var(--text-light);">Miembros del equipo y sus roles</p>
                </div>
            </header>

            <div id="teamList"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <p>Cargando miembros del equipo...</p>
            </div>
        </main>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadUserProfile();
            loadTeamMembers();
        });

        async function loadTeamMembers() {
            const teamList = document.getElementById('teamList');
            if (!teamList) return;

            try {
                const token = localStorage.getItem('token');
                const user = JSON.parse(localStorage.getItem('user'));

                const response = await fetch(`${API_URL}/usuario`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    let usuarios = await response.json();

                    teamList.innerHTML = '';

                    if (usuarios.length === 0) {
                        teamList.innerHTML = '<p>No hay miembros en el equipo.</p>';
                        return;
                    }

                    // Agrupar por rol
                    const roles = {
                        'ADMINISTRADOR': [],
                        'GESTOR_PROYECTO': [],
                        'TRABAJADOR': [],
                        'COLABORADOR': []
                    };

                    usuarios.forEach(usuario => {
                        if (usuario.rol && roles[usuario.rol.nombre]) {
                            roles[usuario.rol.nombre].push(usuario);
                        }
                    });

                    // Renderizar por cada rol
                    Object.keys(roles).forEach(rolNombre => {
                        if (roles[rolNombre].length > 0) {
                            const section = document.createElement('div');
                            section.style.gridColumn = '1 / -1';
                            section.style.marginTop = '20px';

                            const rolTitulos = {
                                'ADMINISTRADOR': 'Administradores',
                                'GESTOR_PROYECTO': 'Gestores de Proyecto',
                                'TRABAJADOR': 'Trabajadores',
                                'COLABORADOR': 'Colaboradores'
                            };

                            section.innerHTML = `<h2 style="font-size: 1.3rem; margin-bottom: 15px;">${rolTitulos[rolNombre]}</h2>`;
                            teamList.appendChild(section);

                            roles[rolNombre].forEach(miembro => {
                                const card = document.createElement('div');
                                card.className = 'card';

                                const inicial = miembro.nombre.charAt(0).toUpperCase();
                                const colorRol = {
                                    'ADMINISTRADOR': '#FF6B6B',
                                    'GESTOR_PROYECTO': '#4ECDC4',
                                    'TRABAJADOR': '#45B7D1',
                                    'COLABORADOR': '#96CEB4'
                                };

                                card.innerHTML = `
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                        <div style="width: 50px; height: 50px; background: ${colorRol[rolNombre]}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 700;">
                                            ${inicial}
                                        </div>
                                        <div style="flex: 1;">
                                            <h3 style="font-size: 1.1rem; margin-bottom: 3px;">${miembro.nombre}</h3>
                                            <p style="font-size: 0.85rem; color: #888;">${miembro.rol ? miembro.rol.nombre.replace('_', ' ') : 'Sin rol'}</p>
                                        </div>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666;">
                                        <p style="margin-bottom: 5px;"><i class="far fa-envelope"></i> ${miembro.email}</p>
                                        ${miembro.telefono ? `<p><i class="fas fa-phone"></i> ${miembro.telefono}</p>` : ''}
                                    </div>
                                `;
                                teamList.appendChild(card);
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('Error:', error);
                teamList.innerHTML = '<p>Error al cargar el equipo.</p>';
            }
        }
    </script>
</body>

</html>